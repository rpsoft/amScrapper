{"version":3,"sources":["index.js"],"names":["express","require","app","path","html","sync","Promise","amazon","amsc","prevData","use","static","__dirname","engine","renderFile","fs","get","allProducts","pausecomp","millis","Math","random","date","Date","curDate","main","ids","data","p","dataDate","getLowestUsedPriceData","outLine","console","log","length","appendFile","err","JSON","stringify","e","req","res","send","ex","portUSed","listen","toISOString","client","createClient","awsId","awsSecret","awsTag","urlDataToObject","query","queryObject","queryElements","split","i","element","key","decodeURIComponent","push","singleVal"],"mappings":"AAAA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,MAAMF,SAAV;AACA,IAAIG,OAAOF,QAAQ,MAAR,CAAX;AACA,IAAIG,OAAOH,QAAQ,MAAR,CAAX;;AAEA,IAAII,OAAOJ,QAAQ,aAAR,CAAX;;AAEA,IAAIK,UAAUL,QAAQ,aAAR,EAAuBK,OAArC;;AAEA,IAAIC,SAASN,QAAQ,oBAAR,CAAb;;AAEA,IAAIO,OAAOP,QAAQ,qBAAR,CAAX;;AAEA,IAAIQ,WAAWR,QAAQ,WAAR,CAAf;;AAEAC,IAAIQ,GAAJ,CAAQV,QAAQW,MAAR,CAAeC,YAAY,oBAA3B,CAAR;;AAEAV,IAAIQ,GAAJ,CAAQV,QAAQW,MAAR,CAAeC,YAAY,QAA3B,CAAR;;AAEAV,IAAIW,MAAJ,CAAW,OAAX,EAAoBZ,QAAQ,KAAR,EAAea,UAAnC;;AAEA,IAAIC,KAAKd,QAAQ,IAAR,CAAT;;AAGAC,IAAIc,GAAJ,CAAQ,GAAR;;AAEA,IAAIC,cAAc,EAAlB;;AAGA,SAASC,SAAT,CAAmBC,MAAnB,EAA2B;AAC3B;AACEA,WAASA,SAAQ,OAAKC,KAAKC,MAAL,EAAtB;AACF,MAAIC,OAAO,IAAIC,IAAJ,EAAX;AACA,MAAIC,UAAU,IAAd;;AAEA,KAAG;AAAEA,cAAU,IAAID,IAAJ,EAAV;AAAuB,GAA5B,QACMC,UAAQF,IAAR,GAAeH,MADrB;AAEC;;AAED,eAAeM,IAAf,GAAqB;;AAGnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,MAAI;AACJ;AACE,QAAIC,MAAM,CAAC,YAAD,EAAc,YAAd,EAA2B,YAA3B,EAAwC,YAAxC,EACR,YADQ,EACK,YADL,EACkB,YADlB,EAC+B,YAD/B,EAC4C,YAD5C,EACyD,YADzD,EACsE,YADtE,EACmF,YADnF,EACgG,YADhG,EAC6G,YAD7G,EAC0H,YAD1H,EACuI,YADvI,EACoJ,YADpJ,EACiK,YADjK,EAC8K,YAD9K,EAC2L,YAD3L,EACwM,YADxM,EACqN,YADrN,EACkO,YADlO,EAC+O,YAD/O,EAC4P,YAD5P,EACyQ,YADzQ,EACsR,YADtR,EACmS,YADnS,EACgT,YADhT,EAC6T,YAD7T,EAC0U,YAD1U,EACuV,YADvV,EACoW,YADpW,EACiX,YADjX,EAC8X,YAD9X,EAC2Y,YAD3Y,EACwZ,YADxZ,EACqa,YADra,EACkb,YADlb,EAC+b,YAD/b,EAC4c,YAD5c,EACyd,YADzd,EACse,YADte,EACmf,YADnf,EACggB,YADhgB,EAC6gB,YAD7gB,EAC0hB,YAD1hB,EACuiB,YADviB,EACojB,YADpjB,EACikB,YADjkB,EAC8kB,YAD9kB,EAC2lB,YAD3lB,EACwmB,YADxmB,EACqnB,YADrnB,EACkoB,YADloB,EAC+oB,YAD/oB,EAC4pB,YAD5pB,EACyqB,YADzqB,EACsrB,YADtrB,EACmsB,YADnsB,EACgtB,YADhtB,EAC6tB,YAD7tB,EAC0uB,YAD1uB,EACuvB,YADvvB,EACowB,YADpwB,EACixB,YADjxB,EAC8xB,YAD9xB,EAC2yB,YAD3yB,EACwzB,YADxzB,EACq0B,YADr0B,EACk1B,YADl1B,EAC+1B,YAD/1B,EAC42B,YAD52B,EACy3B,YADz3B,EACs4B,YADt4B,EACm5B,YADn5B,EACg6B,YADh6B,EAC66B,YAD76B,EAC07B,YAD17B,EACu8B,YADv8B,EACo9B,YADp9B,EACi+B,YADj+B,EAC8+B,YAD9+B,EAC2/B,YAD3/B,EACwgC,YADxgC,EACqhC,YADrhC,EACkiC,YADliC,EAC+iC,YAD/iC,EAC4jC,YAD5jC,EACykC,YADzkC,EACslC,YADtlC,EACmmC,YADnmC,EACgnC,YADhnC,EAC6nC,YAD7nC,EAC0oC,YAD1oC,EACupC,YADvpC,EACoqC,YADpqC,EACirC,YADjrC,EAC8rC,YAD9rC,EAC2sC,YAD3sC,EACwtC,YADxtC,EACquC,YADruC,EACkvC,YADlvC,EAC+vC,YAD/vC,EAC4wC,YAD5wC,EACyxC,YADzxC,EACsyC,YADtyC,EACmzC,YADnzC,EACg0C,YADh0C,EAC60C,YAD70C,EAC01C,YAD11C,EACu2C,YADv2C,EACo3C,YADp3C,EACi4C,YADj4C,EAC84C,YAD94C,EAC25C,YAD35C,EACw6C,YADx6C,EACq7C,YADr7C,EACk8C,YADl8C,EAC+8C,YAD/8C,EAC49C,YAD59C,EACy+C,YADz+C,EACs/C,YADt/C,EACmgD,YADngD,EACghD,YADhhD,EAC6hD,YAD7hD,EAC0iD,YAD1iD,EACujD,YADvjD,EACokD,YADpkD,EACilD,YADjlD,EAC8lD,YAD9lD,EAC2mD,YAD3mD,EACwnD,YADxnD,EACqoD,YADroD,EACkpD,YADlpD,EAC+pD,YAD/pD,EAC4qD,YAD5qD,EACyrD,YADzrD,EACssD,YADtsD,EACmtD,YADntD,EACguD,YADhuD,EAC6uD,YAD7uD,EAC0vD,YAD1vD,EACuwD,YADvwD,EACoxD,YADpxD,EACiyD,YADjyD,EAC8yD,YAD9yD,EAC2zD,YAD3zD,EACw0D,YADx0D,EACq1D,YADr1D,EACk2D,YADl2D,EAC+2D,YAD/2D,EAC43D,YAD53D,EACy4D,YADz4D,EACs5D,YADt5D,EACm6D,YADn6D,EACg7D,YADh7D,EAC67D,YAD77D,EAC08D,YAD18D,EACu9D,YADv9D,EACo+D,YADp+D,EACi/D,YADj/D,EAC8/D,YAD9/D,EAC2gE,YAD3gE,EACwhE,YADxhE,EACqiE,YADriE,EACkjE,YADljE,EAC+jE,YAD/jE,EAC4kE,YAD5kE,EACylE,YADzlE,EACsmE,YADtmE,EACmnE,YADnnE,EACgoE,YADhoE,EAC6oE,YAD7oE,EAC0pE,YAD1pE,EACuqE,YADvqE,EACorE,YADprE,EACisE,YADjsE,EAC8sE,YAD9sE,EAC2tE,YAD3tE,EACwuE,YADxuE,EACqvE,YADrvE,EACkwE,YADlwE,EAC+wE,YAD/wE,EAC4xE,YAD5xE,EACyyE,YADzyE,EACszE,YADtzE,EACm0E,YADn0E,EACg1E,YADh1E,EAC61E,YAD71E,EAC02E,YAD12E,EACu3E,YADv3E,EACo4E,YADp4E,EACi5E,YADj5E,EAC85E,YAD95E,EAC26E,YAD36E,EACw7E,YADx7E,EACq8E,YADr8E,EACk9E,YADl9E,EAC+9E,YAD/9E,EAC4+E,YAD5+E,EACy/E,YADz/E,EACsgF,YADtgF,EACmhF,YADnhF,EACgiF,YADhiF,EAC6iF,YAD7iF,EAC0jF,YAD1jF,EACukF,YADvkF,EAColF,YADplF,EACimF,YADjmF,EAC8mF,YAD9mF,EAC2nF,YAD3nF,EACwoF,YADxoF,EACqpF,YADrpF,EACkqF,YADlqF,EAC+qF,YAD/qF,EAC4rF,YAD5rF,EACysF,YADzsF,EACstF,YADttF,EACmuF,YADnuF,EACgvF,YADhvF,EAC6vF,YAD7vF,EAC0wF,YAD1wF,EACuxF,YADvxF,EACoyF,YADpyF,EACizF,YADjzF,EAC8zF,YAD9zF,EAC20F,YAD30F,EACw1F,YADx1F,EACq2F,YADr2F,EACk3F,YADl3F,EAC+3F,YAD/3F,EAC44F,YAD54F,EACy5F,YADz5F,EACs6F,YADt6F,EACm7F,YADn7F,EACg8F,YADh8F,EAC68F,YAD78F,EAC09F,YAD19F,EACu+F,YADv+F,EACo/F,YADp/F,EACigG,YADjgG,EAC8gG,YAD9gG,EAC2hG,YAD3hG,EACwiG,YADxiG,EACqjG,YADrjG,EACkkG,YADlkG,EAC+kG,YAD/kG,EAC4lG,YAD5lG,EACymG,YADzmG,EACsnG,YADtnG,EACmoG,YADnoG,EACgpG,YADhpG,EAC6pG,YAD7pG,EAC0qG,YAD1qG,EACurG,YADvrG,EACosG,YADpsG,EACitG,YADjtG,EAC8tG,YAD9tG,EAC2uG,YAD3uG,EACwvG,YADxvG,EACqwG,YADrwG,EACkxG,YADlxG,EAC+xG,YAD/xG,EAC4yG,YAD5yG,EACyzG,YADzzG,EACs0G,YADt0G,EACm1G,YADn1G,EACg2G,YADh2G,EAC62G,YAD72G,EAC03G,YAD13G,EACu4G,YADv4G,EACo5G,YADp5G,EACi6G,YADj6G,EAC86G,YAD96G,EAC27G,YAD37G,EACw8G,YADx8G,EACq9G,YADr9G,EACk+G,YADl+G,EAC++G,YAD/+G,EAC4/G,YAD5/G,EACygH,YADzgH,EACshH,YADth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","file":"index.js","sourcesContent":["var express = require('express');\nvar app = express();\nvar path = require(\"path\");\nvar html = require(\"html\");\n\nvar sync = require('synchronize');\n\nvar Promise = require('es6-promise').Promise;\n\nvar amazon = require('amazon-product-api');\n\nvar amsc = require(\"./amazonScrapper.js\")\n\nvar prevData = require(\"./data.js\")\n\napp.use(express.static(__dirname + '/domainParserviews'));\n\napp.use(express.static(__dirname + '/views'));\n\napp.engine('.html', require('ejs').renderFile);\n\nvar fs = require('fs');\n\n\napp.get('/')\n\nvar allProducts = [];\n\n\nfunction pausecomp(millis) // The ultimate stop for a few millis script.\n{\n  millis = millis+(2000*Math.random());\nvar date = new Date();\nvar curDate = null;\n\ndo { curDate = new Date(); }\nwhile(curDate-date < millis);\n}\n\nasync function main(){\n\n\n  // var data = await amsc.getProductIDS(\"https://www.amazon.co.uk/s/ref=nb_sb_noss_1?url=search-alias%3Daps&field-keywords=dvd+players\");\n  //\n  // allProducts = allProducts.concat(data[\"pids\"]);\n  // console.log(data[\"pids\"]);\n  //\n  //\n  // while ( data.nextUrl != undefined){\n  //     pausecomp(1500);\n  //     console.log(\"wait so it is not suspicious\");\n  //     data = await amsc.getProductIDS(\"https://www.amazon.co.uk\"+data.nextUrl);\n  //     allProducts = allProducts.concat(data.pids);\n  //     console.log(\"docs: \"+allProducts.length);\n  //     console.log(\"docs: \"+data.nextUrl);\n  // }\n  //\n  // for ( var p in allProducts){\n  //     pausecomp(1000);\n  //     console.log(allProducts[p].productId);\n  //     var apiData = await amsc.getDataForProduct(allProducts[p].productId);\n  //     allProducts[p][\"amazonData\"] = apiData;\n  //     //console.log(JSON.stringify(apiData));\n  // }\n\n\n  try {\n  //  var ids = [\"B004VXT666\",\"B0082O29D2\",\"B000N17ZHC\",\"B000MRJ4KS\",\"B00004TIZW\",\"B00XTBKYVM\",\"B0002V23ZW\",\"B000CMGUV4\",\"B002BEIYGA\",\"B00006ANXL\",\"B000ARFPFS\",\"B00005AK8U\",\"B0054MO4R4\",\"B00006RVH6\",\"B00015GYT0\",\"B00FEJ4M1K\",\"B0000B12QO\",\"B00QPFJ7G2\",\"B000UJYQ2O\",\"B007PP21DC\",\"B00019FO24\",\"B000I202FI\",\"B000GKTXIE\",\"B0000U5GMM\",\"B000FCSWRQ\",\"B00005B98H\",\"B000GEA3RA\",\"B00L4H0706\",\"B001CS0QP8\",\"B00YQD3ZU4\",\"B00005ML6Q\",\"B000H10W7I\",\"B00005T3YI\",\"B0015IJE7G\",\"B00021O4V8\",\"B000K1TKOQ\",\"B00XWNA7FA\"];\n    var ids = [\"B001AO4LBE\",\"B001CS0QP8\",\"B001GMTIT0\",\"B003ZR4ZDS\",\n      \"B003AM8EOE\",\"B00133NV04\",\"B008HT8FU8\",\"B004PL4IK8\",\"B00A9IXHIA\",\"B007WRPCNO\",\"B0023ALNFG\",\"B0019JLG36\",\"B005AWCOWK\",\"B00C6ZBKX8\",\"B000REWYNK\",\"B00656GEV2\",\"B0087FRRME\",\"B005QWDBI0\",\"B00F8J42X4\",\"B003AX27AA\",\"B00IK4TZOK\",\"B004HCI1LW\",\"B004X63CXE\",\"B00FW2W38I\",\"B0033BW4ES\",\"B00B83LU70\",\"B009YAGNXU\",\"B009MQEU1I\",\"B00FEJ4M1K\",\"B004I1KVYC\",\"B00AGAONZ2\",\"B003SB6RLE\",\"B004AMHA0C\",\"B000YZLBHM\",\"B00519RBMA\",\"B00534AU80\",\"B00361JJ2K\",\"B008VE3CHA\",\"B007BGF0PG\",\"B00TMCF34K\",\"B002WJY42C\",\"B00HYNLLEA\",\"B00MRDZ936\",\"B00DCEOQ5Q\",\"B003ANS2YK\",\"B003AJ7OE8\",\"B007SXDH98\",\"B005CBA12E\",\"B005F5RGBG\",\"B004GFAFF0\",\"B003AVMZ7C\",\"B009D1D5FO\",\"B0028FZPOG\",\"B004MF34S4\",\"B00579OCCG\",\"B0038KNNJY\",\"B009CK9H6W\",\"B0038KTYAQ\",\"B000F4FA0G\",\"B00BG5BT1C\",\"B00004U3BV\",\"B00KQ6A85U\",\"B00JXXXOS0\",\"B0035CPEVU\",\"B00CZCKPJW\",\"B00AZENWTM\",\"B003AJ7ODY\",\"B01AQAS3KW\",\"B00BJ5PIFW\",\"B0009PUVFK\",\"B0065907GC\",\"B00I6HZ3OC\",\"B004PJLNYE\",\"B004LNL6V4\",\"B00FXCC508\",\"B00CMF5G6E\",\"B009B56OXW\",\"B00250EGBC\",\"B001QWVHU8\",\"B003Y814M8\",\"B009W6SA3W\",\"B00X6D1DMC\",\"B00EPPTTIU\",\"B00IH1E7Z8\",\"B00BUL4NM4\",\"B00YUJV12S\",\"B0106GV330\",\"B002SV04HS\",\"B007BGF196\",\"B00A3C2EMW\",\"B00YQD3ZU4\",\"B002WHFMN4\",\"B00FP2Z4OU\",\"B006N70DOM\",\"B002BZZY4Y\",\"B00CUEEP5U\",\"B002SDCQJK\",\"B00P6N9KE8\",\"B004N2IJ0O\",\"B00HBVY93U\",\"B004190R1S\",\"B003VX56MK\",\"B00L1CZZ3I\",\"B014OMTLOA\",\"B00K2B5BK6\",\"B007ERVCF4\",\"B0044A37B6\",\"B004NWDPB2\",\"B00GWAO1IY\",\"B00CSV72UK\",\"B00REORJJK\",\"B0039XU7B2\",\"B004TW62QG\",\"B0053H6JOQ\",\"B000E81FPM\",\"B00EF7ZCWK\",\"B003B4YH38\",\"B00ESDJ592\",\"B00OV7TGE4\",\"B00KGPQQW0\",\"B007R5XEFY\",\"B0038JECKE\",\"B0016G1ABA\",\"B002WJCQ4U\",\"B00JXMFR90\",\"B00858CZF2\",\"B007D5LY6O\",\"B0080H77PQ\",\"B00OBL5OM8\",\"B00JFDXIKM\",\"B00NH4NY1S\",\"B00C86PKT0\",\"B001CF60R4\",\"B005I5LNH6\",\"B0053GUXBC\",\"B0087FQPP4\",\"B004612IWM\",\"B008MWLHY6\",\"B00JE6UIUS\",\"B002ISQAFQ\",\"B002N4G7QW\",\"B00EOV3H4C\",\"B007S71NZO\",\"B00L2JX4DS\",\"B00KLE0E88\",\"B00C8SHXKW\",\"B006KGNUZA\",\"B008PB8Z7G\",\"B00J3VHT3S\",\"B00JJTGK98\",\"B00B8TOFSU\",\"B00KQ5LERM\",\"B00WRCY08M\",\"B000QC94WW\",\"B004CYWVAM\",\"B00DCFZ5P0\",\"B0145QN4F2\",\"B00A71YOQI\",\"B008PB8XN2\",\"B0111AVIJO\",\"B008MWLHX2\",\"B003EX0BVS\",\"B003E4M4WQ\",\"B009RUU4HI\",\"B00SNN6N8O\",\"B00THLNVY0\",\"B005MCX4CW\",\"B00FW7ATEI\",\"B002PU9Z9U\",\"B00FFJ3QUC\",\"B008RAZ8DE\",\"B00TAD0IKA\",\"B00YQ4D15M\",\"B004SBHSZ2\",\"B007KQE1UC\",\"B00KRM1X3Y\",\"B004QIPKNY\",\"B00KC0HVTQ\",\"B007F9XHAY\",\"B015PK4IAW\",\"B00KJ10E60\",\"B00BG2KWTK\",\"B007F9XHBI\",\"B00KM4SDPI\",\"B00P1IE8WM\",\"B009BZW8PK\",\"B00EXR6N84\",\"B00F4H95T6\",\"B014NG27BG\",\"B00J8WW6XA\",\"B00OAKXTPY\",\"B00ODIZ3H0\",\"B00E2TYXGC\",\"B007LNTPS2\",\"B00GO8Q632\",\"B004VXT666\",\"B0082O29D2\",\"B0054MO4R4\",\"B00F67DN38\",\"B00006I5N8\",\"B002W8S2YO\",\"B00E7A0S24\",\"B00115LAW0\",\"B0001P545A\",\"B0080QZ25Y\",\"B016YJYUZ6\",\"B00MU2OZQG\",\"B017EXLCTI\",\"B00OZ57MPW\",\"B00PB0K810\",\"B01BJ6VPVQ\",\"B01BJ6VELW\",\"B00G4REGJE\",\"B00UUDEHNI\",\"B00MX78V18\",\"B000I4FH8S\",\"B014TNDIMU\",\"B00449X3HA\",\"B00BN9CH1M\",\"B00P9GG5A4\",\"B00890H11Y\",\"B008VF6D6G\",\"B007ECGFLU\",\"B003JFKNG4\",\"B00C2LVYKK\",\"B00G6K7RKE\",\"B004QGXX5S\",\"B00PBBUJW2\",\"B00EN1BOE8\",\"B004QGXX62\",\"B00EN1BOE8\",\"B0041XIJX2\",\"B00P1B2MJU\",\"B00HBUV1E6\",\"B005HFHJVQ\",\"B009ZQ7KRG\",\"B009F2GD0A\",\"B00IU2Y3BM\",\"B003BL13WY\",\"B00AJVUCOY\",\"B007FGAWVO\",\"B00XTBKYVM\",\"B00XWNA7FA\",\"B00IIVUH3S\",\"B00E9G496M\",\"B00LMB75SG\",\"B00U1SWNF6\",\"B00GO71GQA\",\"B00KC5ET0K\",\"B00G1PR844\",\"B00IHHG2JQ\",\"B004BVVYCM\",\"B003WBZ7FM\",\"B00CMLITTE\",\"B007LNSF4C\",\"B0085H2O7M\",\"B006OR5IYQ\",\"B007XI1TAW\",\"B018UXEI1A\",\"B00TIRZKG0\",\"B00MY8NKZI\",\"B005WVLOPM\",\"B00KQVEMXE\",\"B0040EIQQC\",\"B00O4GJOQ2\",\"B00FSGUNEE\",\"B0089ZQ3OK\",\"B0017OHFPG\",\"B003Q0XA3K\",\"B00GXFIFN0\",\"B003XTYP38\",\"B00YHYXGZ6\",\"B00TOR5VCC\",\"B009XP191C\",\"B009PDJ5EK\",\"B00H4FKBFS\",\"B00SKA0PB6\",\"B00QJIJ3C8\",\"B0143J32I0\",\"B00MU2M266\",\"B008041AOS\",\"B00VGX0LE0\",\"B00VGX016I\",\"B00MX5N5CK\"];\n\n\n\n      ids = prevData.data\n\n      for ( var p in ids){\n          pausecomp(2000);\n        //  console.log(ids[p][\"productId\"]);\n          try {\n            //var apiData = await amsc.getDataForProduct(ids[p][\"productId\"]);\n            var dataDate = await amsc.getLowestUsedPriceData(ids[p][\"productId\"]);\n            //console.log(JSON.stringify(dataDate));\n            var outLine = ids[p][\"productId\"]+\n                      \",\"+dataDate[\"cheapestUsed\"]+\n                      \",\"+dataDate[\"cheapestCondition1\"]+\n                      \",\"+dataDate[\"cheapestCondition2\"]+\n                      \",\"+dataDate[\"sellerStarRating\"]+\n                      \",\"+dataDate[\"percentPositive\"];\n            console.log(outLine + \" \"+p+\"/\"+ids.length);\n\n            fs.appendFile('dataoutoutuk.txt', outLine+\"\\n\", function (err) {\n              if (err) {\n                console.log(\"Error writting: \"+outLine)\n              }\n            })\n\n            //console.log(ids[p]+\",\"+dataDate[\"latestReviewDate\"].replace(\",\",\"\")+\",\"+dataDate[\"firstReviewDate\"].replace(\",\",\"\"));\n            //allProducts.push(apiData);\n            console.log(\"APIDATA \"+JSON.stringify(dataDate));\n          } catch (e) {\n            console.log(e);\n            console.log(\"OH WELL KEEP GOING!\");\n          }\n\n      }\n\n\n      //console.log(\"ALL PRODS \" +JSON.stringify(allProducts));\n  } catch (e){\n    console.log(e);\n  }\n\n}\n\n\nmain();\n\n\n\n\n\n\napp.get('/data',function(req,res){\n  try {\n    // var queryObject = urlDataToObject(req._parsedOriginalUrl.query);\n    //   //  console.log(JSON.stringify(req._parsedOriginalUrl));\n    // var page = queryObject[\"page\"];\n    // //client.itemLookup()\n    // client.itemLookup({\n    //   //searchIndex: 'Electronics',\n    //   ItemId:\"B007BYLO4E,B01GO72M9O,B007F9XHAY,B00ODDE33U\",\n    //   responseGroup: 'ItemAttributes,Offers,Reviews,SalesRank',\n    //   //ItemPage: page\n    // }).then(function(results){\n    //   console.log(JSON.stringify(results));\n    //   res.send(results);\n    // }).catch(function(err){\n    //   console.log(JSON.stringify(err));\n    // });\n\n    res.send(allProducts);\n\n\n  } catch( ex){\n    console.log(ex);\n    res.send(\"\");\n  }\n\n});\nvar portUSed = 3020;\napp.listen(portUSed, function () {\n  console.log('AmazonScrapper Running on port '+portUSed +\"\"+ new Date().toISOString());\n});\n\nvar client = amazon.createClient({\n  awsId: \"AKIAI7UIBW6PANJASE6A\",\n  awsSecret: \"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\",\n  awsTag: \"somethingElse\"\n});\n\n\n\n// client.itemSearch({\n//   Brand: 'Sony',\n//   searchIndex: 'Electronics',\n//   Keywords: 'dvd player',\n//   responseGroup: 'ItemAttributes,Offers,Images'\n// }).then(function(results){\n//   console.log(JSON.stringify(results));\n// }).catch(function(err){\n//   console.log(JSON.stringify(err));\n// });\n\nfunction urlDataToObject(query){\n  var queryObject = {};\n  if (query ){\n    var queryElements = query.split(\"&\"); //This is the GET variable contents. (Probably POST as well).\n    for ( var i in queryElements){\n        var element = queryElements[i].split(\"=\");\n        var key = decodeURIComponent(element[0]);\n\n        key = key.split(\"[\")[0]; // ugly fix. get variables that contain an array are postfixed by \"[]\". I didn't know this before I made this function.\n\n        if ( !queryObject[key] ){\n              queryObject[key] = [];\n        }\n\n\n        queryObject[key].push(element[1]);\n        //queryObject[element[0]] = element[1];\n    }\n\n    for ( var i in queryObject ){\n         if ( queryObject[i].length === 1){\n           var singleVal = queryObject[i][0];\n            queryObject[i] = singleVal;\n         }\n    }\n\n  }\n  return queryObject;\n}\n"]}